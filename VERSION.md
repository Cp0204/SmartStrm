# SmartStrm What's New

## v0.3.6
- 302
  - **适配 Emby 中音乐类型的 302 请求**：已测试音流、Emby Web 端、安卓客户端，需网盘支持直链（115、123、天翼驱动支持；夸克驱动音频不支持直链，在 `智能回落` 模式下，自动转为NAS代理请求），OpenList 驱动则跟随其存储特性
- 驱动
  - 天翼云盘：修复 emby 删除同步时 path 报错的问题
  - 天翼云盘：修复内部重授权后重试未更新请求头，导致的容器重启时初始化死循环
- 插件
  - 飞牛影视刷新：修复不扫描任务根目录的问题

## v0.3.5
- 驱动
  - 天翼云盘：修复云盘非 VIP 用户获取套餐失败时报错的问题
- 插件
  - 飞牛影视刷新：调整免费试用次数至 100 次，且可手动重置
- 302
  - 修复 LAN IP 的判断
  - 修复 `没有兼容的流` 的问题

## v0.3.4
- 驱动
  - 115开放平台：优化刷新令牌失效判断逻辑
  - **天翼云盘：支持家庭共享**，重构请求处理
- 插件
  - **新增 飞牛影视刷新 插件**：运行任务同时刷新飞牛影视，自动匹配媒体库、扫描指定目录，自动移除缺失影片，支持夸克、115、123网盘（飞牛影视不支持 STRM ，仅作为添加了挂载网盘的媒体库刷新使用）
  - 优化 非法文件名修正 插件：改进修正后文件路径的处理逻辑，避免部分场景下重复修正
- Webhook
  - 为 CloudSaver 推送增加 open115, pan123 支持，配置方法同夸克
- 其他
  - 优化内网IP检测逻辑，支持 IPv4 和 IPv6 双协议检测
  - 优化版本检查逻辑，提高服务可用性
  - 统一 /smartstrm_fid 路由，附加路径参数
  - 优化部分日志输出，改善用户体验
  - 优化天翼屎山代码、增加新的屎山代码

## v0.3.3
- 驱动
  - 夸克网盘：修复违规文件的文件名变 `某***` 的问题 #39
- 其他
  - 支持 IPv6 ，默认启用监听双栈，可通过环境变量 `ENABLE_IPV6` 控制

## v0.3.2
- 驱动
  - 123云盘开放平台：修复使用 `文件编号模式` 时获取直链失败和报错
  - 115开放平台：修复某些系统（已知群晖）下的 pick_code 缓存报错

## v0.3.1
- 驱动
  - WebDAV：新增对UTC时间格式的支持
  - WebDAV：修复生成时传递多余参数报错的问题
  - 夸克网盘：添加 `转码最高画质` 配置选项，用于限制获取转码直链时的最高画质

## v0.3.0
- STRM 生成
  - **云盘类存储生成支持 `文件编号模式`**：以文件编号替代原路径方式写入 STRM 内容，减少API请求，可稍微提高起播速度（推荐）；改模式后重新生成建议使用以下 `全量覆写` 功能
- 驱动
  - **本地文件系统：添加 `兼容模式` 选项，以支持 CloudDrive2/Rclone/SMB 等挂载点的文件变更监听**
  - 123云盘开放平台：添加 `重新授权` 选项，避免每次保存都重新请求 token
  - 夸克网盘：更新 M3U8 直链白名单支持 Hills, Yamby 客户端（Yamby需MPV播放）
  - 夸克网盘：改进回落逻辑，当获取视频转码直链错误时，例如新上传资源在转码中，回落到原码代理
  - OpenList：兼容 AList 旧版和小雅无 created 字段
- 任务工具
  - 增加 `全量覆写` 功能：强制历遍所有目录、覆盖生成，避免先删除再生成时媒体库中媒体被自动移除
  - 优化 `STRM 查找替换` 功能：替换内容不改变文件时间，避免媒体库中排序打乱
- 插件
  - 修复任务级插件先启用再关闭时不应用全局插件配置
- UI
  - 修正 Webhook URL 为和当前请求相同的访问协议
  - 任务编辑：更新 `增量生成模式` 的标签和描述
  - 文件浏览：优化文件重命名和删除后处理逻辑，免重请求更新列表
  - 新建任务：优化路径参数处理逻辑，兼容末尾带 `/` 时能正常获取下级目录
- 其他
  - 驱动重构统一文件操作接口，优化调用效率
  - 调整版本检查代码到后端

## v0.2.3
- 驱动
  - 123云盘开放平台：新增 `增强目录变更检测` 选项，使用目录大小信息（有10min左右滞后）辅助识别多层级的变更，建议开启
  - 123云盘开放平台：修复复制文件时“获取文件数据失败”
- STRM 生成
  - 修复自 v0.2.0 引入的重复获取复制文件数据 bug

## v0.2.2
- 驱动
  - **添加 123云盘开放平台 支持**，需自行申请[成为开发者](https://www.123pan.com/developer)
  - 夸克网盘：新增 `增强识别目录修改时间` 选项，以多层级下的最近文件新建时间作为父辈目录修改时间，建议开启
  - 本地文件系统：增强文件监听的异常处理
- UI
  - 优化驱动参数字段默认值设定

## v0.2.1
- STRM 生成
  - 修复0字节元数据文件复制错误导致的任务中断
- 驱动
  - 本地文件系统：优化本地监听任务的启动与停止逻辑
- 构建
  - 更新多个依赖包版本

## v0.2.0
- **添加日志自动清理功能**，默认保留主日志7天、任务日志1000行，可通过环境变量配置
- 驱动
  - 本地文件系统：相关任务**支持实时监听文件变更，即时同步生成** (Pro)
- 插件
  - **支持任务级别的插件配置**：可对不同任务单独配置插件参数
  - Infuse.ISO兼容: 优化命名逻辑，解决与不加后缀插件的冲突

## v0.1.2

- 插件
  - 新增 文件名关键词排除 插件：生成时跳过文件名中含有特定关键词的文件
  - 新增 STRM内容替换 插件：生成时自动替换 STRM 内的文本内容
- 302 代理
  - **支持 Plex Web 的 STRM 播放和 302 重定向**
  - 兼容部分 Plex 客户端 302 重定向（需另行调整 Plex 远程设置）

## v0.1.1

- 插件
  - 非法文件名修正：添加 `"` 为 Windows 文件名非法字符
  - 新增 Infuse.ISO兼容 插件：以 .iso.strm 为后缀命名生成 ISO 文件

## v0.1.0

- STRM 生成
  - 增强错误处理机制，生成错误时跳过而不终止任务
  - 支持部分复制的元数据（海报、json，以 `.-_` 分割）自动增加 .(ext) 更名
  - 重构远程文件存在性检查逻辑，提升性能
- 驱动
  - 115：调整刷新令牌的时间间隔，缓解临界状态刷新失败
- 插件
  - **新增插件系统**，便于后续功能扩展
  - 新增 非法文件名修正 插件：运行任务时重命名远端存储的非法文件名，去除特殊字符、截断过长的文件名
  - 新增 STRM不加扩展名 插件：支持不添加如 .(mp4) 的扩展名
- 构建
  - 更新多个依赖包版本

## v0.0.11

- STRM 生成
  - 修复同名媒体的元数据文件名匹配逻辑
- 驱动
  - 夸克：修复部分视频有画面没有声音
- Webhook
  - 为 a_task, qas_strm, cs_strm, web_save 事件增加延迟执行支持
  - 改进 a_task 事件的 strm 字典处理逻辑为可选覆盖

## v0.0.10

- 驱动
  - 夸克：修复某些场景下载字幕等元数据失败的问题
- 302代理
  - 修复播放本地资源时请求超时导致的暂停问题
- 后台管理
  - 修复登录保持，Cookie 默认有效期 31 天
  - 访问 /login 时，如已登录则自动跳转到首页
- 其他
  - 重构组件加载方式，略微微微优化性能
  - 优化部分日志输出

## v0.0.9

- 驱动
  - 调整 115、天翼的授权信息为主动刷新，减少掉授权的问题
  - 优化 OpenList 目录刷新逻辑，解决新转存目标路径获取失败问题

（本次为部分驱动的优化和稳定性更新，如未使用以上驱动可不更新）

## v0.0.8

- Webhook
  - 增加网页转存时触发任务功能，依赖油猴扩展，支持115、夸克、天翼（使用相应驱动）
- 驱动
  - WebDAV：修复远端返回空时间的报错，兼容 PikPak
- UI
  - 优化存储的用户 VIP 样式

## v0.0.7

- 设置
  - 优化初始化时 SmartStrm/Emby 地址的默认设置
  - 优化版本信息记录和获取方式
- 302代理
  - 夸克：网易爆米花添加到302白名单
- UI
  - 修正正则重命名替换为空时可用性的判断

## v0.0.6

- 302代理
  - 提高调用本地播放器时的起播速度
- 配置管理
  - 优化配置读取逻辑，增加稳定性
  - 增加配置写入异常时的备份机制
- UI
  - 添加任务和存储为空的引导提示
  - 增强前端版本比较和提示

## v0.0.5

- 驱动
  - 修复115一处报错，优化一键授权回调逻辑
  - 夸克优化视频直链获取，**部分资源支持杜比原码**
- 302代理
  - **Emby/Jellyfin 网页端支持嵌入调用外部播放器按钮**
  - 优化其他工具生成的 STRM 处理逻辑
- Webhook
  - 优化 Emby 同步删除代码
  - 增加默认请求返回版本信息并优化错误处理
- UI
  - 增加重命名功能说明
  - 增加关于页和第三方开源许可

## v0.0.4

- 驱动
  - **支持天翼云盘驱动🎉，不依赖 xxList 提供直链**
  - 修复115一处请求失败问题
  - 尝试兼容某些不规范 WebDAV 服务
- Webhook
  - **支持 CloudDrive2 文件变更通知实时触发任务** (Pro) ：*因作者专门斥巨资开了CD2会员来适配调试这个功能，故为Pro功能*
  - 使用多线程处理触发的任务
  - 适配 CloudSaver 使用天翼云盘驱动任务的接收路径
- 任务工具箱
  - 内容替换在当前页面保留输入，方便对多个任务进行相同替换
  - 使用多线程处理后台任务
- 其他
  - 存储名称过滤 / 字符，增强防错
  - 优化异常处理和错误信息返回，帮助识别问题

## v0.0.3

- STRM 生成
  - 优化复制文件名的处理逻辑，如目录下有需生成的同名媒体，将复制的文件命名为 `同名.(media_ext).copy_ext`  解决 nfo 不匹配的问题 https://github.com/Cp0204/SmartStrm/issues/1#issuecomment-3216267328
- 302代理
  - 修复观看 直播/IPTV 没有兼容的流
- 驱动
  - 修复本地文件驱动兼容性问题 #1
  - 修复本地驱动路径问题
- Webhook
  - 优化 Emby 同步删除时无效路径的错误提示

## v0.0.2

- 驱动
  - 添加 115 开放平台一键授权功能
  - 夸克添加 SVIP+ 识别
- STRM 生成
  - 修复大写扩展名的判断异常
  - 调整远程目录读取失败时不创建本地目录
  - 优化日志输出，增加读取目录失败计数
- UI
  - 完善页面文案描述、错误提示、防错
- 部分代码逻辑重构，提升性能

## v0.0.1

首次发布，一个媒体库 STRM 文件生成工具。 和 Emby 优雅配合，支持 302 直链播放，支持同步删除远端文件。 正如其名，配合 quark-auto-save/CloudSaver, OpenList, Emby 力求即存即看。🥳

* 多驱动支持
  * OpenList/AList、WebDAV、本地文件、夸克网盘、115
* STRM 生成
  * 基础生成功能
  * 远端删除自动清理
  * 生成后缀、大小阈值、复制文件后缀等基础设定
* Webhook 支持
  * Emby 媒体删除同步
  * 联动 QAS/CloudSaver 触发任务
* 存储浏览
  * 基础目录浏览
  * 批量重命名（WIP）

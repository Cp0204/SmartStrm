<div align="center">

<img src="img/icon.svg" width="128" height="128">

# SmartStrm

ä¸€ä¸ªåª’ä½“åº“ STRM æ–‡ä»¶ç”Ÿæˆå·¥å…·ã€‚

å’Œ Emby ä¼˜é›…é…åˆï¼Œæ”¯æŒ 302 ç›´é“¾æ’­æ”¾ï¼Œæ”¯æŒåŒæ­¥åˆ é™¤è¿œç«¯æ–‡ä»¶ã€‚

æ­£å¦‚å…¶åï¼Œé…åˆ quark-auto-save/CloudSaver, OpenList, Emby åŠ›æ±‚å³å­˜å³çœ‹ã€‚ğŸ¥³

[![releases][releases-image]][docker-url] [![docker pulls][docker-pulls-image]][docker-url] [![docker image size][docker-image-size-image]][docker-url] [![telegram][telegram-image]][telegram-url]

[telegram-image]: https://img.shields.io/badge/Telegram-2CA5E0?logo=telegram&logoColor=white
[releases-image]: https://img.shields.io/docker/v/cp0204/smartstrm
[docker-pulls-image]: https://img.shields.io/docker/pulls/cp0204/smartstrm?logo=docker&&logoColor=white
[docker-image-size-image]: https://img.shields.io/docker/image-size/cp0204/smartstrm?logo=docker&&logoColor=white
[github-url]: https://github.com/Cp0204/smartstrm
[docker-url]: https://hub.docker.com/r/cp0204/smartstrm
[telegram-url]: https://t.me/smartstrm

![run_log](img/main.png)

</div>

## ç‰¹æ€§

- æ”¯æŒ OpenListã€WebDAVã€Quark ç­‰ç½‘ç»œé©±åŠ¨
- ä»»åŠ¡ç®¡ç†
  - åŸºäº Crontab çš„å®šæ—¶ä»»åŠ¡
  - å•ä¸ªä»»åŠ¡ç‹¬ç«‹æ—¥å¿—
  - ä»»åŠ¡å·¥å…·ç®±ï¼šå†…å®¹æ›¿æ¢ã€ä¸€é”®æ¸…ç†
- STRM ç”Ÿæˆ
  - ç›®å½•æ—¶é—´æ£€æŸ¥
  - å¢é‡/åŒæ­¥ç”Ÿæˆï¼šå¯æ¸…ç†è¿œç«¯å·²åˆ æ–‡ä»¶
  - æŒ‡å®šç”Ÿæˆçš„åª’ä½“åç¼€ã€æ–‡ä»¶å¤§å°é˜ˆå€¼
  - æŒ‡å®šå¤åˆ¶çš„æ–‡ä»¶åç¼€
- Webhook
  - è”åŠ¨ QASã€CloudSaver ç­‰è½¬å­˜å·¥å…·è§¦å‘ä»»åŠ¡
  - Emby åˆ é™¤åª’ä½“åŒæ­¥åˆ é™¤è¿œç«¯æ–‡ä»¶
- ç²—ç³™ä½†æå…¶å‹å¥½çš„ç®¡ç†é¡µé¢
  - å­˜å‚¨æµè§ˆã€æ‰¹é‡é‡å‘½å
  - ä»»åŠ¡æ—¥å¿—æŸ¥çœ‹
- ä¸€ç«™å¼ Emby Jellyfin 302 ç›´é“¾æ’­æ”¾ (Pro)

## éƒ¨ç½²

éƒ¨ç½²å‘½ä»¤

```bash
docker run -d \
  --name smartstrm \
  --restart unless-stopped \
  --network host \
  -v /yourpath/smartstrm/config:/app/config \  # æŒ‚è½½é…ç½®ç›®å½•
  -v /yourpath/smartstrm/logs:/app/logs \  # æŒ‚è½½æ—¥å¿—ç›®å½•ï¼Œå¯é€‰
  -v /yourpath/smartstrm/strm:/strm \  # æŒ‚è½½ STRM ç”Ÿæˆç›®å½•
  -e PORT=8024 \  # ç®¡ç†ç«¯å£ï¼Œå¯é€‰
  -e ADMIN_USERNAME=admin \  # ç®¡ç†ç”¨æˆ·å
  -e ADMIN_PASSWORD=admin123 \  # ç®¡ç†ç”¨æˆ·å¯†ç 
  -e LICENSE= \  # è®¸å¯è¯å­—ç¬¦ä¸²ï¼ˆå¦‚æœ‰ï¼‰
  cp0204/smartstrm:latest
```

docker-compose.yml

```yaml
name: smartstrm
services:
  smartstrm:
    image: cp0204/smartstrm:latest
    container_name: smartstrm
    restart: unless-stopped
    network_mode: host
    volumes:
      - /yourpath/smartstrm/config:/app/config # æŒ‚è½½é…ç½®ç›®å½•
      - /yourpath/smartstrm/logs:/app/logs # æŒ‚è½½æ—¥å¿—ç›®å½•ï¼Œå¯é€‰
      - /yourpath/smartstrm/strm:/strm # æŒ‚è½½ STRM ç”Ÿæˆç›®å½•
    environment:
      - PORT=8024 # ç®¡ç†ç«¯å£ï¼Œå¯é€‰
      - ADMIN_USERNAME=admin # ç®¡ç†ç”¨æˆ·å
      - ADMIN_PASSWORD=admin123 # ç®¡ç†ç”¨æˆ·å¯†ç 
      - LICENSE= # è®¸å¯è¯å­—ç¬¦ä¸²ï¼ˆå¦‚æœ‰ï¼‰
```


## ä½¿ç”¨

**åŸç†ï¼š** [STRM æ–‡ä»¶](https://emby.media/support/articles/Strm-Files.html) æ˜¯ä¸€ä¸ªç½‘ç»œèµ„æºçš„å¿«æ·æ–¹å¼ï¼Œå®ƒä½¿å¾—æ— é¡»åœ¨æœ¬åœ°å­˜å‚¨åª’ä½“æ–‡ä»¶ï¼Œè®© Emby ç›´æ¥ä»ç½‘ç»œä¸Šæ’­æ”¾åª’ä½“æ–‡ä»¶ï¼Œå› æ‰«æåª’ä½“åº“åªè¯†åˆ«æ–‡ä»¶åï¼Œè€Œä¸ç”¨è¯»å–åª’ä½“æ–‡ä»¶å†…å®¹ï¼Œæ‰€ä»¥å…¥åº“æå¿«ã€‚æ”¯æŒ STRM æ–‡ä»¶çš„æœ‰ Emby, Jellyfin, Kodi ç­‰ã€‚

### SmartStrm çš„ä½¿ç”¨æ­¥éª¤ï¼š

1. æ·»åŠ å­˜å‚¨
2. æ·»åŠ ä»»åŠ¡ï¼Œç”Ÿæˆ STRM æ–‡ä»¶
3. æŒ‚è½½ STRM ç›®å½•ç»™åª’ä½“åº“å®¹å™¨çš„ /strm è·¯å¾„
4. æ‰«æåª’ä½“åº“ï¼Œè¯†åˆ« STRM æ–‡ä»¶

å®Œæˆä»¥ä¸Šæ­¥éª¤ï¼ŒEmby å·²ç»èƒ½å¤Ÿç›´æ¥ä»ç½‘ç›˜ç›´æ¥æä¾›æ’­æ”¾ï¼Œæ­¤æ—¶æ‰€æœ‰è§†é¢‘æµé‡ç»è¿‡ Emby ï¼Œå¦‚æœä½ åœ¨å±€åŸŸç½‘å¤–è®¿é—®ï¼Œå¯èƒ½å—é™äºå®¶ä¸­ç½‘ç»œçš„ä¸Šä¼ å¸¦å®½ï¼ˆç‰¹åˆ«æ˜¯å¤šäººåŒæ—¶æ’­æ”¾æ—¶ï¼‰ã€‚ä½ å¯èƒ½è¿˜éœ€è¦ï¼š

5. è®¾ç½®302ä»£ç†æœåŠ¡å™¨ï¼ˆProï¼‰ï¼Œæ”¹ä» SmartStrm æä¾›çš„ç«¯å£è®¿é—® Emby ï¼Œå°†ç›´æ¥ä»ç½‘ç›˜è·å–è§†é¢‘æµï¼ˆéœ€ç½‘ç›˜æ”¯æŒï¼‰ï¼Œäº«å—æœ€é¡ºç•…çš„æ’­æ”¾ã€‚

## è¿›é˜¶ä½¿ç”¨

### è½¬å­˜è‡ªåŠ¨ç”ŸæˆSTRM

æ”¯æŒå’Œ `quark-auto-save` `CloudSaver` è”åŠ¨ï¼Œåœ¨è½¬å­˜åè§¦å‘ä»»åŠ¡ã€‚æ”¯æŒ**ä»…è§¦å‘è½¬å­˜çš„é‚£ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç§’çº§ç”Ÿæˆ**ã€‚

#### quark-auto-save æ’ä»¶

- **webhook**: SmartStrm Webhook åœ°å€ï¼Œä» `ç³»ç»Ÿè®¾ç½® - Webhook` ä¸­è·å–
- **strmtask**: ç›¸å…³çš„ SmartStrm ä»»åŠ¡åï¼Œæ”¯æŒå¤šä¸ªå¦‚ `tv,movie`
- **xlist_path_fix**: è·¯å¾„æ˜ å°„ï¼Œ SmartStrm ä»»åŠ¡ä½¿ç”¨ å¤¸å…‹ç½‘ç›˜ é©±åŠ¨æ—¶æ— é¡»å¡«å†™ï¼›ä½¿ç”¨ OpenList é©±åŠ¨æ—¶éœ€å¡«å†™å¦‚ `/storage_mount_path:/quark_root_dir` çš„æ ¼å¼ ï¼Œä¾‹å¦‚æŠŠå¤¸å…‹æ ¹ç›®å½•(/)æŒ‚è½½åœ¨ OpenList çš„ /quark ä¸‹ï¼Œåˆ™å¡«å†™ `/quark:/`ã€‚**SmartStrm ä¼šä½¿ OpenList å¼ºåˆ¶åˆ·æ–°ç›®å½•ï¼Œæ— éœ€å†ç”¨ alist æ’ä»¶åˆ·æ–°ã€‚**

#### CloudSaver æ‰©å±•

åŸºæœ¬å’Œ QAS å‚æ•°é€»è¾‘ç›¸åŒï¼Œä½†éœ€å¢åŠ  `event` `savepath` å’Œè°ƒæ•´ `xlist_path_fix` å‚æ•°ã€‚


- **webhook**: åŒQAS
- **strmtask**: åŒQAS
- **event**: `cs_strm`
- **savepath**: `/{savePath}`
- **xlist_path_fix**: ä½¿ç”¨ OpenList é©±åŠ¨æ—¶éœ€å¡«å†™ã€‚å¤¸å…‹ç½‘ç›˜åŒQASï¼Œå¤©ç¿¼äº‘ç›˜ `/ä½ æŒ‚è½½åœ¨oplistçš„è·¯å¾„:/å…¨éƒ¨æ–‡ä»¶` ï¼Œåªæ”¹åŠ¨ : å‰é¢éƒ¨åˆ†ï¼Œåé¢ /å…¨éƒ¨æ–‡ä»¶ ä¿æŒä¸å˜ã€‚

<details>
<summary>å¤©ç¿¼ç½‘ç›˜é…ç½®ç¤ºä¾‹å›¾</summary>

![cs_189_set](img/cs_189_set.png)

</details>

<details>
<summary>å¤¸å…‹ç½‘ç›˜é…ç½®ç¤ºä¾‹å›¾</summary>

![cs_quark_set](img/cs_quark_set.png)

</details>


### Emby åˆ é™¤åŒæ­¥

> éœ€æŠŠ STRM ç›®å½•æŒ‚è½½åˆ° Emby å®¹å™¨çš„ /strm è·¯å¾„ä¸‹

åœ¨ `SmartStrm - Webhook - Emby åˆ é™¤åŒæ­¥è®¾ç½®` ä¸­å¯ç”¨åŠŸèƒ½ï¼Œé»˜è®¤å…³é—­ã€‚

åœ¨ `Emby - åå°ç®¡ç† - é€šçŸ¥` ä¸­è®¾ç½®ï¼š

- **ç½‘å€**ï¼š SmartStrm Webhook åœ°å€
- **è¯·æ±‚å†…å®¹ç±»å‹**: application/json
- **Events**: å‹¾é€‰ `åª’ä½“åº“-åª’ä½“åˆ é™¤`

## 302 ä»£ç†

> ä½¿ç”¨ SmartStrm æä¾›çš„ 302 ä»£ç†ï¼Œå°† Emby å®¢æˆ·ç«¯æ’­æ”¾è¯·æ±‚é‡å®šå‘ï¼Œç›´æ¥ä»ç›´é“¾è·å–è§†é¢‘æµï¼Œä¸å— Emby æœåŠ¡å™¨çš„å¸¦å®½é™åˆ¶ã€‚
>
> æµ‹è¯•æ”¯æŒç»å¤§å¤šæ•°æä¾› http ç›´é“¾çš„ç½‘ç›˜ï¼Œå¦‚ä½¿ç”¨ OpenList - å¤©ç¿¼ æ–¹æ¡ˆè¾ƒä¸ºå®Œç¾ã€‚
>
> å›¾æ ‡ç¤ºæ„: âœ…å…¼å®¹ âŒä¸å…¼å®¹ ğŸŸ¡éƒ¨åˆ†å…¼å®¹ âš«æœªæµ‹è¯•

### æŒ‰é©±åŠ¨åˆ†

| é©±åŠ¨        | Emby 302 | Jellyfin 302 | å¤‡æ³¨                                                  |
| ----------- | -------- | ------------ | ----------------------------------------------------- |
| OpenList    | âœ…        | âœ…            | å¦‚æœ oplist å¼€å¯302ï¼Œç›´é“¾å…¼å®¹æ€§ä¾èµ–äºç½‘ç›˜èƒ½å¦æä¾›ç›´é“¾ |
| å¤¸å…‹ç½‘ç›˜    | ğŸŸ¡        | ğŸŸ¡            | é»˜è®¤ä½¿ç”¨è½¬ç ç›´é“¾ï¼Œéƒ¨åˆ†è§†é¢‘ä¸å…¼å®¹ï¼Œå¯ç”¨æ™ºèƒ½å›è½åˆ°ä»£ç†  |
| 115å¼€æ”¾å¹³å° | âœ…        | âœ…            | ç›´é“¾å®Œç¾å…¼å®¹ï¼›ä½†æ™®é€šç”¨æˆ·APIé™é€Ÿï¼Œé¢‘ç¹æŠ¥é”™             |

### æŒ‰å®¢æˆ·ç«¯åˆ†

| å®¢æˆ·ç«¯     | Emby | Jellyfin | å¤‡æ³¨                             |
| ---------- | ---- | -------- | -------------------------------- |
| Web        | ğŸŸ¡    | ğŸŸ¡        | ä¸å…¼å®¹å¤¸å…‹éƒ¨åˆ†è½¬ç èµ„æºï¼Œå…¶ä»–æ­£å¸¸ |
| Android    | âœ…    | âš«        |                                  |
| Android TV | ğŸŸ¡    | -        | ä¸å…¼å®¹å¤¸å…‹éƒ¨åˆ†è½¬ç èµ„æºï¼Œå…¶ä»–æ­£å¸¸ |
| VidHub     | âœ…    | âœ…        |                                  |
| Yamby      | ğŸŸ¡    | -        | ä¸å…¼å®¹å¤¸å…‹éƒ¨åˆ†è½¬ç èµ„æºï¼Œå…¶ä»–æ­£å¸¸ |
| AfuseKt    | âœ…    | âœ…        |                                  |

## Q&A

#### Q: æ˜¯å¦æ”¯æŒç½‘ç›˜è½¬å­˜ã€è‡ªåŠ¨è½¬å­˜ï¼Ÿ
> A: æš‚æ— è®¡åˆ’ï¼Œåšå¥½ä¸€ä»¶äº‹ï¼Œå°‘å³æ˜¯å¤šã€‚å¸‚é¢ä¸Šå·²ç»æœ‰ä¸å°‘è½¬å­˜å·¥å…·ï¼Œä¸é‡å¤é€ è½®å­ï¼Œé™¤éæˆ‘æœ‰ä¿¡å¿ƒåšæˆæœ€å¥½ç”¨çš„è½®å­ã€‚

#### Q: å…è´¹å’Œæ”¶è´¹ï¼Ÿ
> A: åŸºç¡€åŠŸèƒ½å…è´¹ï¼ˆSTRMç”Ÿæˆï¼ŒWebhookï¼‰ï¼Œå·²ç»èƒ½å¤Ÿæ»¡è¶³ç»å¤§å¤šæ•°äººéœ€æ±‚ï¼Œé«˜çº§åŠŸèƒ½ä»˜è´¹ï¼ˆ302ä»£ç†ï¼‰ï¼Œå®šä»·æå…¶åˆç†ã€‚

#### Q: 302ä»£ç†ä¹‹åå¯ä»¥åˆ†äº«ç»™å®¶äººå’Œæœ‹å‹ç”¨å— è¿™æ ·ä¼šé£æ§å—ï¼Ÿ
> A: ä»£ç†åç›´æ¥ç”±å®¢æˆ·ç«¯å‘ç½‘ç›˜è¯·æ±‚ä¸‹è½½ï¼Œèƒ½è¯†åˆ«åˆ°å¤šIPã€å¤šUAç”¨ä½ çš„è´¦å·åœ¨è¯·æ±‚ä¸‹è½½ã€‚æˆ‘è§‰å¾—çœ‹ç¨‹åº¦å§ï¼Œä¸‰äº”äººéƒ½é—®é¢˜ä¸å¤§ï¼Œå‡è®¾æˆ‘å°±æ˜¯å®¶é‡Œç™»å½•äº†ã€å…¬å¸åœ¨å¼‚åœ°ä¹Ÿç™»å½•äº†ï¼Œå±äºæ­£å¸¸ä½¿ç”¨éœ€æ±‚ã€‚ä½†ä½ è¦æ˜¯å…¬å¼€å‡ºå»åŒæ—¶åå‡ ã€å‡ åå¤„å¼‚åœ°ä¸‹è½½ï¼Œåªèƒ½è¯´æœ‰é£é™©ï¼Œé£é™©è‡ªæ‹…ã€‚

#### Q: å…³äºç›®å½•æ—¶é—´æ£€æŸ¥é€‰é¡¹çš„å·¥ä½œæœºåˆ¶ï¼Ÿ
> A: è¿™ä¸ªé€‰é¡¹æ˜¯ä¸ºäº†æœ€å°åŒ–åœ°è¯·æ±‚æ¥å£ï¼Œå’Œæœ€å¿«çš„é€Ÿåº¦å®Œæˆä»»åŠ¡ã€‚è¿œç«¯ç›®å½•çš„ä¿®æ”¹æ—¶é—´å°±æ›´æ–°äº†ï¼Œæ¯”æœ¬åœ°æ–°ï¼Œå°±ä¼šå¾€ä¸‹æ£€æŸ¥ã€‚å·²çŸ¥115æ–°å¢/åˆ é™¤æ–‡ä»¶éƒ½ä¼šæ›´æ–°çˆ¶ç›®å½•çš„ä¿®æ”¹æ—¶é—´ï¼›å¤¸å…‹ç½‘ç›˜æ–°å¢ä¼šæ›´æ–°ä½†åˆ é™¤ä¸ä¼šï¼›å„ä¸ªç›˜å¯èƒ½æœºåˆ¶ä¸ä¸€ï¼Œéœ€è¦è‡ªè¡Œæµ‹è¯•ã€‚

#### Q: æ˜ å°„äº† 302 ä»£ç†ç«¯å£è®¿é—® Emby ï¼Œè¿˜è¦ä¸è¦æ˜ å°„ SmartStrm ç«¯å£ï¼Ÿ
>A: ä¸éœ€è¦ï¼Œå¦‚æœç”¨ SS çš„ 302 ä»£ç†åŠŸèƒ½ï¼Œåˆ†äº«ä»£ç†åçš„ Emby ç«¯å£å‡ºå»ï¼ŒSTRM åœ°å€å¯ä»¥ç›´æ¥ç”¨å†…ç½‘ï¼Œä»£ç†ä¼šè‡ªè¡Œå¤„ç†ã€‚åˆ«äººè®¿é—®ä¸åˆ° SmsrtStrm æˆ– STRM çš„åœ°å€ï¼Œèƒ½è®¿é—®çš„åªæœ‰ä»£ç†åçš„ Emby æœåŠ¡ï¼Œæ‰€ä»¥æˆ‘ç§°ä¹‹ä¸º â€œä¸€ç«™å¼ Emby Jellyfin 302 ç›´é“¾æ’­æ”¾â€ ã€‚
